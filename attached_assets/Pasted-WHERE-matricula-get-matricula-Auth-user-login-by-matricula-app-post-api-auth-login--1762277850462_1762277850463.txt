WHERE matricula = ?').get(matricula);
// Auth (user login by matricula)
app.post('/api/auth/login', (req, res) => {
 const { matricula } = req.body;
 if (!matricula) return res.status(400).json({ error: 'matricula
required' });
 const user = getUserByMatricula(matricula);
 if (!user) return res.status(404).json({ error: 'User not found' });
 const token = jwt.sign({ id: user.id, role: user.role, name:
user.full_name, matricula: user.matricula }, JWT_SECRET, { expiresIn:
'12h' });
 res.json({ token, role: user.role, name: user.full_name });
});
// Admin login (matricula + password)
app.post('/api/auth/admin-login', (req, res) => {
 const { matricula, password } = req.body;
 if (!matricula || !password) return res.status(400).json({ error:
'matricula and password required' });
 const user = getUserByMatricula(matricula);
 if (!user || user.role !== 'admin') return res.status(404).json({ error:
'Admin not found' });
 if (!bcrypt.compareSync(password, user.password_hash || '')) return
res.status(401).json({ error: 'Invalid password' });
 const token = jwt.sign({ id: user.id, role: user.role, name:
user.full_name, matricula: user.matricula }, JWT_SECRET, { expiresIn:
'12h' });
 res.json({ token, role: user.role, name: user.full_name });
});
// Admin: create users
app.post('/api/admin/users', authMiddleware('admin'), (req, res) => {
 const { full_name, matricula, role = 'user', password } = req.body;
 if (!full_name || !matricula) return res.status(400).json({ error: 'missing
fields' });
 const pwHash = password ? bcrypt.hashSync(password, 8) : null;
 try {
 const stmt = db.prepare('INSERT INTO users (full_name, matricula, role,
password_hash) VALUES (?, ?, ?, ?)');
 const info = stmt.run(full_name, matricula, role, pwHash);
 res.json({ id: info.lastInsertRowid });
 } catch (e) {
 res.status(400).json({ error: e.message });
 }
});
app.get('/api/admin/users', authMiddleware('admin'), (req, res) => {
 const rows = db.prepare('SELECT id, full_name, matricula, role, created_at
FROM users').all();
 res.json(r